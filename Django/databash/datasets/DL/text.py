from sentence_transformers import SentenceTransformer
from transformers import logging
from sklearn.metrics.pairwise import cosine_similarity
import numpy as np

logging.set_verbosity_error()

class TextFilter:
    def __init__(self, threshold=0.45):
        self.model = SentenceTransformer('bert-base-nli-mean-tokens')
        self.threshold = threshold
    
    def run(self, path, text):
        storedEmbeds = np.load(path, allow_pickle=True)
        textEmbeds = self.model.encode([text])
        probs = cosine_similarity(storedEmbeds, textEmbeds)
        return False if probs.item(0) > self.threshold else True
    
    def generateFilter(self, textList, path):
        textEmbeds = self.model.encode(textList)
        meanEmbeds = np.mean(textEmbeds, axis=0)[np.newaxis, :]
        np.save(path, meanEmbeds)
        return meanEmbeds


if __name__ == '__main__':
    sentences = [
        "I always wrote this series off as being a complete stink-fest because Jim Belushi was involved in it, and heavily. But then one day a tragic happenstance occurred. After a White Sox game ended I realized that the remote was all the way on the other side of the room somehow. Now I could have just gotten up and walked across the room to get the remote, or even to the TV to turn the channel. But then why not just get up and walk across the country to watch TV in another state? ""Nuts to that"", I said. So I decided to just hang tight on the couch and take whatever Fate had in store for me. What Fate had in store was an episode of this show, an episode about which I remember very little except that I had once again made a very broad, general sweeping blanket judgment based on zero objective or experiential evidence with nothing whatsoever to back my opinions up with, and once again I was completely right! This show is a total crud-pie! Belushi has all the comedic delivery of a hairy lighthouse foghorn. The women are physically attractive but too Stepford-is to elicit any real feeling from the viewer. There is absolutely no reason to stop yourself from running down to the local TV station with a can of gasoline and a flamethrower and sending every copy of this mutt howling back to hell. <br /><br />Except.. <br /><br />Except for the wonderful comic sty lings of Larry Joe Campbell, America's Greatest Comic Character Actor. This guy plays Belushi's brother-in-law, Andy, and he is gold. How good is he really? Well, aside from being funny, his job is to make Belushi look good. That's like trying to make butt warts look good. But Campbell pulls it off with style. Someone should invent a Nobel Prize in Comic Buffoonery so he can win it every year. Without Larry Joe this show would consist of a slightly vacant looking Courtney Thorne-Smith smacking Belushi over the head with a frying pan while he alternately beats his chest and plays with the straw on the floor of his cage. 5 stars for Larry Joe Campbell designated Comedic Bacon because he improves the flavor of everything he's in!",
        "It's been about 14 years since Sharon Stone awarded viewers a leg-crossing that twisted many people's minds. And now, God knows why, she's in the game again. ""Basic Instinct 2"" is the sequel to the smash-hit erotica ""Basic Instinct"" featuring a sexy Stone and a vulnerable Michael Douglas. However, fans of the original might not even get close to this one, since ""Instinct 2"" is painful film-making, as the mediocre director Michael Caton-Jones assassinates the legacy of the first film.<br /><br />The plot of the movie starts when a car explosion breaks in right at the beginning. Catherine Tramell (Sharon Stone, trying to look forcefully sexy) is a suspect and appears to be involved in the murder. A psychiatrist (a horrible David Morrisey) is appointed to examine her, but eventually falls for an intimate game of seduction.<br /><br />And there it is, without no further explanations, the basic force that moves this ""Instinct"". Nothing much is explained and we have to sit through a sleazy, C-class erotic film. Sharon Stone stars in her first role where she is most of the time a turn-off. Part of it because of the amateurish writing, the careless direction, and terrifyingly low chemistry. The movie is full of vulgar dialogues and even more sexuality (a menage a trois scene was cut off so that this wouldn't be rated NC-17) than the first entrance in the series. ""Instinct"" is a compelling torture.<br /><br />To top it off, everything that made the original film a guilty pleasure is not found anywhere in the film. The acting here is really bad. Sharon Stone has some highlights, but here, she gets extremely obnoxious. David Morrisey stars in the worst role of his life, and seems to never make more than two expressions in the movie- confused and aroused. ""Instinct 2"" is a horrible way to continue an otherwise original series, that managed to put in thriller with erotica extremely well. Paul Verhoeven, how I miss you....<br /><br />""Basic Instinct 2"" never sounded like a good movie, and, indeed, it isn't. Some films should never get out of paper, and that is the feeling you get after watching this. Now, it is much easier to understand why Douglas and David Cronenberg dropped out, and why Sharon Stone was expecting a huge paycheck for this......-----3/10",
        "someone needed to make a car payment... this is truly awful... makes jean Claude's cyborg look like gone with the wind... this is an hour I wish I could sue to get back... luckily it produced severe somnolence... from which I fell asleep. how can actors of this caliber create this dog? I would rather spend the time watching algae grow on the side of a fish tank than partake of this wholly awful concoction of several genre. I now use the DVD as a coaster on my coffee table. $5.99 at walmart is far too much to spend on this movie... if you really have to have it, wait till they throw them out after they have carried them on the inventory for several years and are frustrated that they would not sell.<br /><br />please for the love of god let this movie die of obscurity.",
        "The Guidelines state that a comment must contain a minimum of four lines. That is the only reason I am saying anything more about Tomcats. Because after all, my one line summary really says everything there is to say. There is absolutely NOTHING remotely entertaining in this film.",
        "This movie is a muddled mish-mash of clich√©s from recent cinema. There are some promising ideas in there, but while the director was clearly aiming to wind up with a hauntingly ambiguous film, what he ended up with was a confusing mess. Lead actor Daniel Wu does a fair job but with no central theme it seems as though he doesn't have much to work with. Furthermore, the movie is largely devoid of scares (although, in fairness, there are some creepy moments amid the drudgery).<br /><br />*MILD SPOILERS*<br /><br />We have the mysterious death of an estranged twin, diabolical librarians, ghostly love interests, identity confusion, death by savage monkeys, oedipal conflict, abusive stepfathers, sublimated homosexuality, and crime gang connections. The only real commonality these elements share seems to be that they cause the protagonist to express a vague sense of confusion and discontent. <br /><br />Perhaps the most disappointing aspect to this film is that despite the brother's death by monkeys being strongly featured on the DVD cover, the act itself is never directly portrayed. Instead, director Julian Lee uses what appears to be stock footage of monkeys - not very scary.<br /><br />*END SPOILERS*<br /><br />Avoid this one. For an excellent psychological, ambiguous horror tale, check out the Korean film A Tale of Two Sisters (2003)."
        "Why did I waste 1.5 hours of my life watching this? Why was this film even made? Why am I even commenting on this film?<br /><br />One reviewer said this film took patience to watch and it was n't for everybody. I cannot figure out who this movie is for. maybe after dropping a hit of acid, SOMEBODY, SOMEWHERE could watch this and make some sense out of it. It is incoherent, it isn't experimental, it's plain and simple garbage. The film follows no plot line whatsoever, just when you think you have something, well.....you don't. <br /><br />I think the ending brought some finality to the film (no pun intended), the viewer gets a glimpse of what might have been going on. I don't think I put a spoiler in here, not that it would matter. This film is another must miss in the world of filmdom.",
        "This film takes you on one family's impossible journey, and makes you feel every step of their odyssey. Beautifully acted and photographed, heartbreakingly real. Its last line, with its wistful hope, is one of the more powerful in memory.",
        "The Russian space station 'Avna' with a crew of four Russians and two Americans is threatening to re-enter the Earth's atmosphere in a matter of days. Russia asks for NASA's help in rescuing the stranded crew and NASA scrambles the space shuttle Atlantis. The NSA also have an interest in the 'Prometheus', a prototype microwave power source being tested aboard 'Avna' and organise for one of their men to be placed on the mission.<br /><br />That's the plot. Onto less important things. The space station and the shuttle are the same, blatantly obvious models used in 'Fallout', 'Memorial Day' and 'Dark Breed' (and a handful of other films, I suspect). The model effects are so obvious throughout the entire movie and make the film look very 1960s. The sets are a little better but are far too '80s for what is supposedly a brand new station built by an American company (which later comes in as part of a conspiracy to destroy 'Avna' and the 'Prometheus' and claim the insurance. The script has a few good moments (including Yuri's farewell and the little spiel at the end) but is otherwise fairly bland and sub-standard. The acting is okay; the only real standout performance comes from Alex Veadov who offers up some of the film's better dialogue. Michael Dudikoff is, surprisingly, one of the best parts about this film. Ice-T is Ice-T. 'Nuff said. The film offers a few surprises, though, that I don't wish to spoil.<br /><br />Certainly one of the better low-grade, contemporary-set sci-fi films of the last six years, but not the best. The film is watchable but the special effects and plot will probably put a lot of viewers off. Rent the other 'Stranded' sci-fi film instead.",
        "the more i think about it, there was nothing redeeming about this<br /><br />movie. i saw it 9 months ago, so my memory might have made it<br /><br />worse than it was, but i do know it was at least as bad as a 4 out of<br /><br />10. <br /><br />after seeing the movie, i met the director. he seemed so clueless<br /><br />as to what he was doing or what he had done, and as far as i<br /><br />could tell, he didn't care for the film either. even he agreed that he<br /><br />didn't really know what he was doing, and he was forced to do<br /><br />certain things because it was filmed digitally. <br /><br />i felt that the movie was trying to hard to fit in to the formula that it<br /><br />built for itself: ""9 people all have to be connected in some way. how<br /><br />can we get from point 'A' to point 'B'"" so in order get from the<br /><br />prostitute we see in the start and back to her at the end they 10<br /><br />minutes on each character's relationship to another person. it<br /><br />makes one feel choked by the 2 demensional, badly drawn<br /><br />characters.<br /><br />I just remembered the one redeeming part of the movie... Steve<br /><br />Bouchemi there is one scene where he is amazing. that's it. as i<br /><br />say... 4 out of 10.",
        "This is very dated, but that's part of the charm with this 1933 movie. You can say the same for most Pre-Code films; they're just different, and usually in an interesting way.<br /><br />It was the short running time, the great acting of Spencer Tracy and the beautiful face and sweetness of Loretta Young's character which kept me watching and enjoying this stagy-but-intriguing film.<br /><br />You'd be hard-pressed to find a nicer girl than ""Trinna,"" played by the 20-year-old Young who was already into making her 50th movie! (She started acting as a small child. That, and the fact they made movies quickly back in the old days.) The camera, although in soft focus throughout much of the film, zoomed in on Loretta's face and eyes many times and I was mesmerized by her beauty.<br /><br />Playing a crotchety man with a cynical outlook on life, Tracy's ""Bill"" slowly transformed into a loving man, thanks to Trinna. Spencer delivered his lines here with such naturalness that you hardly knew he was acting.<br /><br />Although they have small roles, supporting actors Walter Connolly, Marjorie Rambeau, Arthur Hohl and Glenda Farrell leave lasting impressions long after viewing this 75-minute film. I was particularly fascinated with Connolly's role as the minister/father figure of the camp.<br /><br />The story is a little far-fetched but - hey - that's the movies. This story is about two lonely Great Depression victims trying to survive in a ""Hooverville""-type camp and it winds up to be a very touching tale.",
        "A powerful adaptation of the best-selling book and the smash Broadway play about the lives of Bessie and Sadie Delany, two ""colored"" sisters who lived past the age of 100. Wonderfully played in their old age by Ruby Dee and Diahann Carroll, respectively, they tell their story in flashbacks to Amy Hill Hearth (played by Amy Madigan), a white New York Times reporter. The flashback and present-day scenes don't have as much inspirational value in them as in the book, but really are powerful. However, certain aspects of the sisters' lives, such as the inter-racial background of their mother and the reasons behind their father's stern personality are not presented clearly. You need to read the book to fully understand these things. Which is just as well, because the book's just as great! Aside from those flaws, it's wonderfully done and performed, especially by Dee and Carroll, and a very powerful and educational movie.",
        "This movie's origins are a mystery to me, as I only know as much as IMDB did before I rented it. I assume that before ""Starship Troopers"", ""Killshot"" was one of the countless unaired pilots that never made it to network, cable, or otherwise. The new title of ""Kill Shot"" is comically thrown into the opening sequence, the first of many quick clues that this was not ever intended for the cinema. The quick cuts, cheesy ""Melrose Place"" music, and short 2-second close-up candid shots of the main actors let you know what you're in for.<br /><br />And I don't mind at all. I rented this movie seeing the repackaging that puts Casper Van Dien and Denise Richards on the cover in front of a volleyball net thinking it would be funny to see them in a movie besides the SciFi travesty of Starship Troopers (an excellent book, in my opinion, not so hot a movie - but that's another review). After looking it up on IMDB, my roommate and I surmised that the pilot was dragged up after the apparent success of Troopers and Richards own career (see Bond-Girl and Wild Things references here). They threw in a sex scene involving a minor character to reach the coveted R-rated status - coveted in suspense Video Rental sections, that is. In any event, they should have left it unrated if you're trying to sell it in the suspense/softcore porn section.<br /><br />All in all, it's entertaining. I hate to spoil the fun of telling you it's a TV pilot, though. That was the biggest pull while watching it - when you expect a cinematic movie and get a TV show, the differences between them make themselves more clear than usual.<br /><br />Would I rent it again? No. Would I watch this TV show? Well, why not - it's better than Baywatch. And their meager attempts at hitting all demographics would have done well back in the mid 90s. Token black guy (who's gay to avoid the TV taboo of inter-racial dating), token Asian (Japanese, I assume from the name Koji) more adept at science and computers than talking to women, beautiful, intelligent Latina pre-med student who has everything going for her except her family's bank account - this show probably would have done ok.<br /><br />But as a movie it just cracks me.<br /><br />I gave it a 7 out of 10, considering what it was and what it was forced to become. It made for a very enjoyable evening, and that's all I ask of rentals.",
        "I really enjoyed the first film and when it turned up again, without thinking, or checking, I took a family of friends to see it. I was ashamed that I had enthused so much about it to them.<br /><br />Disney processed the original film just like the human body processes a delicious meal - takes in something good and turns out ... well, you know. And by having a dark-skinned person as the FBI man, the results of fingerprinting the informant were subdued.<br /><br />Taken as an isolated film, I suppose it is not too bad if one likes that weird sort of thing, but when one has read the book or seen the first film - horrible!"
    ]

    text = "I had seen 'Kalifornia' before (must be about 10 years ago) and I still remember to be very impressed by it. That's why I wanted to see it again and all I can say is that it still hasn't lost its power, even though I'm used to a lot more when it comes to movies than that I was ten years ago.<br /><br />'Kalifornia' tells the tale of the writer Brian Kessler and his girlfriend Carrie Laughlin, a photographer, who want to move to California. But instead of stepping on a plain and flying right to the state where they say it never rains, they choose to make a trip by car. He wants to write a book about America's most famous serial killers and she will make the matching pictures. But because their car uses an enormous amount of petrol, they decide to take another couple with them, so they can spread the costs of the trip. Only one couple has answered the add, so they will automatically be the lucky ones. But they haven't met each other yet and when seeing the other couple for the first time, when their trip has already started, Carrie is shocked. Without wanting to be prejudiced, she can only conclude that Early Grayce and Adele Corners are poor white trailer park trash. She definitely doesn't want them in her car, but Brian doesn't really mind to take them with them and decides to stop and pick them up anyway. At first the couple doesn't seem to be that bad after all, but gradually Early Grayce changes from a trashy hillbilly into a remorseless murderer...<br /><br />Not only is the story very impressive, so is the acting from our four leads. Brad Pitt is incredible as Early Grayce. His performance in this movie may well be his best ever. The same for Juliette Lewis. She plays the childish and naive girlfriend that doesn't want to hear a bad word about her Early and does that really very well. But David Duchovny and Michelle Forbes are a surprise as well. They both did a very good job and I really wonder why we never heard anything from Forbes again since this movie, because she really proves to have a lot of talent.<br /><br />Overall this is a very good and impressive psychological thriller with a very powerful story, but because of the graphic violence, I can imagine that it may not be to everybody's taste (although I don't really see another way how to portray a serial killer in a believable way). Personally I really liked this movie a lot and the violence never bothered me (it's a part of the story that's too important to be left out). I reward this movie with an 8/10."
    tf = TextFilter()
    tf.generateFilter(sentences, './filter.npy')
    print(tf.run('./filter.npy', text))